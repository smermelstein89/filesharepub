---  
- name: RHEL7 Ansible STIG
  hosts: stig # enter hostnames here
  become: yes
  # updates: Test
#71891#, 71903#, 71905#, 71907#, 71909#, 71911#, 71913#, 71915#, 71917#, 71921#, 71925#, 71929#, 71933#, 71935#, 71939#, 71941#
#V_71951, V_71957, V_71959, V_71973, V_71975, V_71987, V_71989, V_71991 , V_71993 , V_72051 , V_72069 , V_72071 , V_72073 , V_72081, V_72083, V_72085
#72087, V_72091, V_72099, V_72101, V_72103, V_72105, V_72107, V_72109, V_#72111#, V_#72113#, V_#72115#, V_#72117#, V_#72119#, V_#72121#, V_72125#, V_72127#
#72129#, V_72131#, V_72133#, V_72135#, V_72137#, V_72139#, V_72141#, V_72147#, V_72149#, V_72151#, V_72153#, V_72155#, V_72157#, V_72159#, V_72161#, V_72165#, V_
#72167#, V_72173#, V_72175#, V_72177#, V_72179#, V_72183#, V_72185#, V_72199#, V_72201#, V_72203#, V_72205#, V_72207#, V_72209, V_72217, V_72221, V_72223, V_
#72227#, V_72229#, V_72231, V_72237, V_72241, V_72245, V_72247, V_72253, V_72259, V_72309, V_73155, V_73157, V_73159, V_73163, V_78997, V_94843

####test-roles-1 testing ####
###V_71891#, V_71907#, V_71909#, V_71911#, V_71913#, V_71915#, V_71921#, V_71925#, V_71929#, V_71933#, V_71935#, V_71939#, V_71941#
##V_71951#, V_71957#, V_71959#, V_71973#, V_71987#, V_71989#, V_71991#, 71993#, 72069#, V_72087#, V_72091#, V_72099#
###V_72101, V_72103, V_72105, V_72107, V_72109, V_72111, V_72113, V_72115, V_72117, V_72119, V_72121, V_72125, V_72127
###V_72129, V_72131, V_72133, V_72135, V_72137, V_72139, V_72141, V_72147, V_72149, V_72151, V_72153, V_72155, V_72157, V_72159, V_72161
###V_72165, V_72167, V_72173, V_72175, V_72177, V_72179, V_72183, V_72185, V_72199, V_72201, V_72203, V_72205, V_72207, V_72221
###V_72227, V_72229, V_72237, V_72241, V_72245, V_72247, V_72253, V_72259, V_72309, V_73155, V_73157, V_73159
#V_72071#, V_72073#, V_72081#, V_72083, V_72231, V_73163, V_78997, V_94843#
#2nd wave
# V_71855, 59 61 63 

  vars:  
    inactivity_timeout_value: 900 #true
    login_banner_text: | #true
        You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.
        By using this IS (which includes any device attached to this IS), you consent to the following conditions:
        -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.
        -At any time, the USG may inspect and seize data stored on this IS.
        -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.
        -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.
        -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details. 
    rsyslog_remote_loghost_address: ignite2 #true
    sshd_approved_macs: hmac-sha2-256,hmac-sha2-512 #true
    sshd_idle_timeout_value: 600 #true
    sysctl_net_ipv4_conf_all_accept_redirects_value: 0 #true
    sysctl_net_ipv4_conf_all_accept_source_route_value: true
    sysctl_net_ipv4_conf_default_accept_redirects_value: 0 #true
    sysctl_net_ipv4_conf_default_accept_source_route_value: true
    sysctl_net_ipv4_icmp_echo_ignore_broadcasts_value: 1 #true
    sysctl_net_ipv6_conf_all_accept_source_route_value: 0 #true
    var_account_disable_post_pw_expiration: 0 #true
    var_accounts_fail_delay: 4 #true
    var_accounts_max_concurrent_login_sessions: 10 #true
    var_accounts_maximum_age_login_defs: 60 #true
    var_accounts_minimum_age_login_defs: 1 #true
    var_accounts_passwords_pam_faillock_deny: true
    var_accounts_passwords_pam_faillock_fail_interval: true
    var_accounts_passwords_pam_faillock_unlock_time: true
    var_accounts_tmout: 6000 #true set to 6000 for patch maintenance purposes
    var_accounts_user_umask: 077 #true
    var_auditd_action_mail_acct: root #true
    var_auditd_space_left:  true #leave it?
    var_auditd_space_left_action: email #true
    var_password_pam_dcredit: -1 #true
    var_password_pam_difok: 8 #true
    var_password_pam_lcredit: -1 #true
    var_password_pam_maxclassrepeat: 4 #true
    var_password_pam_maxrepeat: 3 #true
    var_password_pam_minclass: 4 #true
    var_password_pam_minlen: 15 #true
    var_password_pam_ocredit: -1 #true
    var_password_pam_retry: 3 #true
    var_password_pam_ucredit: -1 #true
    var_password_pam_unix_remember: 5 #true
    var_removable_partition: true
    var_selinux_policy_name: targeted #true
    var_selinux_state: enforcing #true
    var_sshd_set_keepalive: 0 #true
    var_sssd_ldap_tls_ca_dir: demand  #true
    account_disable_post_pw_expiration: true
    accounts_logon_fail_delay: true
    accounts_max_concurrent_login_sessions: true
    accounts_maximum_age_login_defs: true
    accounts_minimum_age_login_defs: true
    accounts_password_pam_dcredit: -1 #true
    accounts_password_pam_difok: 8 #true
    accounts_password_pam_lcredit: -1 #true
    accounts_password_pam_maxclassrepeat: 4 #true
    accounts_password_pam_maxrepeat: 3 #true
    accounts_password_pam_minclass: 4 #true
    accounts_password_pam_minlen: 15 #true
    accounts_password_pam_ocredit: -1 #true
    accounts_password_pam_retry: 3 #true
    accounts_password_pam_ucredit: -1 #true
    accounts_password_pam_unix_remember: 5 #true
    accounts_passwords_pam_faillock_deny: true
    accounts_passwords_pam_faillock_deny_root: true
    accounts_passwords_pam_faillock_interval: true
    accounts_passwords_pam_faillock_unlock_time: true
    accounts_tmout: true
    accounts_umask_etc_login_defs: true
    aide_periodic_cron_checking: true
    sys_admin_email: root@cce.techrep.navy.smil.mil #root@sysname.mil
    audit_rules_dac_modification_chmod: true
    audit_rules_dac_modification_chown: true
    audit_rules_dac_modification_fchmod: true
    audit_rules_dac_modification_fchmodat: true
    audit_rules_dac_modification_fchown: true
    audit_rules_dac_modification_fchownat: true
    audit_rules_dac_modification_fremovexattr: true
    audit_rules_dac_modification_fsetxattr: true
    audit_rules_dac_modification_lchown: true
    audit_rules_dac_modification_lremovexattr: true
    audit_rules_dac_modification_lsetxattr: true
    audit_rules_dac_modification_removexattr: true
    audit_rules_dac_modification_setxattr: true
    audit_rules_execution_chcon: true
    audit_rules_execution_semanage: true
    audit_rules_execution_setfiles: true
    audit_rules_execution_setsebool: true
    audit_rules_file_deletion_events_rename: true
    audit_rules_file_deletion_events_renameat: true
    audit_rules_file_deletion_events_rmdir: true
    audit_rules_file_deletion_events_unlink: true
    audit_rules_file_deletion_events_unlinkat: true
    audit_rules_kernel_module_loading_delete: true
    audit_rules_kernel_module_loading_finit: true
    audit_rules_kernel_module_loading_init: true
    audit_rules_login_events_faillock: true
    audit_rules_login_events_lastlog: true
    audit_rules_login_events_tallylog: true
    audit_rules_privileged_commands: true
    audit_rules_privileged_commands_chage: true
    audit_rules_privileged_commands_chsh: true
    audit_rules_privileged_commands_crontab: true
    audit_rules_privileged_commands_gpasswd: true
    audit_rules_privileged_commands_newgrp: true
    audit_rules_privileged_commands_pam_timestamp_check: true
    audit_rules_privileged_commands_passwd: true
    audit_rules_privileged_commands_postdrop: true
    audit_rules_privileged_commands_postqueue: true
    audit_rules_privileged_commands_ssh_keysign: true
    audit_rules_privileged_commands_su: true
    audit_rules_privileged_commands_sudo: true
    audit_rules_privileged_commands_sudoedit: true
    audit_rules_privileged_commands_umount: true
    audit_rules_privileged_commands_unix_chkpwd: true
    audit_rules_privileged_commands_userhelper: true
    audit_rules_unsuccessful_file_modification_creat: true
    audit_rules_unsuccessful_file_modification_ftruncate: true
    audit_rules_unsuccessful_file_modification_open: true
    audit_rules_unsuccessful_file_modification_open_by_handle_at: true
    audit_rules_unsuccessful_file_modification_openat: true
    audit_rules_unsuccessful_file_modification_truncate: true
    audit_rules_usergroup_modification_group: true
    audit_rules_usergroup_modification_gshadow: true
    audit_rules_usergroup_modification_opasswd: true
    audit_rules_usergroup_modification_passwd: true
    audit_rules_usergroup_modification_shadow: true
    auditd_audispd_encrypt_sent_records: true
    auditd_data_retention_action_mail_acct: true
    auditd_data_retention_space_left: true
    auditd_data_retention_space_left_action: true
    clean_components_post_updating: true
    configure_strategy: true
    dconf_gnome_banner_enabled: true
    dconf_gnome_enable_smartcard_auth: true
    dconf_gnome_login_banner_text: true
    dconf_gnome_screensaver_idle_activation_enabled: true
    dconf_gnome_screensaver_idle_delay: true
    dconf_gnome_screensaver_lock_delay: true
    dconf_gnome_screensaver_lock_enabled: true
    dconf_gnome_screensaver_user_locks: true
    dconf_gnome_session_idle_user_locks: true
    disable_ctrlaltdel_reboot: true
    disable_host_auth: true
    disable_strategy: true
    enable_strategy: true
    ensure_gpgcheck_globally_activated: true
    ensure_gpgcheck_local_packages: true
    file_groupowner_cron_allow: true
    file_owner_cron_allow: true
    file_permissions_sshd_private_key: true
    file_permissions_sshd_pub_key: true
    gnome_gdm_disable_automatic_login: true
    gnome_gdm_disable_guest_login: true
    grub2_enable_fips_mode: true
    high_complexity: true
    high_disruption: true
    high_severity: true
    kernel_module_dccp_disabled: true
    low_complexity: true
    low_disruption: true
    low_severity: true
    medium_disruption: true
    medium_severity: true
    mount_option_home_nosuid: true
    mount_option_krb_sec_remote_filesystems: true
    mount_option_noexec_remote_filesystems: true
    mount_option_nosuid_remote_filesystems: true
    mount_option_nosuid_removable_partitions: true
    no_empty_passwords: true
    no_reboot_needed: true
    package_aide_installed: true
    package_screen_installed: true
    package_vsftpd_removed: true
    package_ypserv_removed: true
    patch_strategy: true
    reboot_required: true
    require_singleuser_auth: true
    restrict_strategy: true
    rpm_verify_hashes: true
    rpm_verify_ownership: true
    rpm_verify_permissions: true
    rsyslog_remote_loghost: true
    security_patches_up_to_date: true
    selinux_policytype: true
    selinux_state: true
    service_auditd_enabled: true
    service_autofs_disabled: true
    service_firewalld_enabled: true
    service_kdump_disabled: true
    service_sshd_enabled: true
    set_password_hashing_algorithm_libuserconf: true
    set_password_hashing_algorithm_logindefs: true
    skip_ansible_lint: true
    sshd_allow_only_protocol2: true
    sshd_disable_compression: true
    sshd_disable_empty_passwords: true
    sshd_disable_gssapi_auth: true
    sshd_disable_kerb_auth: true
    sshd_disable_rhosts_rsa: true
    sshd_disable_root_login: true
    sshd_do_not_permit_user_env: true
    sshd_enable_strictmodes: true
    sshd_enable_warning_banner: true
    sshd_enable_x11_forwarding: true
    sshd_print_last_log: true
    sshd_set_idle_timeout: true
    sshd_set_keepalive: true
    sshd_use_approved_ciphers: true
    sshd_use_approved_macs: true
    sshd_use_priv_separation: true
    sssd_ldap_configure_tls_ca_dir: true
    sssd_ldap_start_tls: true
    sysctl_kernel_randomize_va_space: true
    sysctl_net_ipv4_conf_all_accept_redirects: true
    sysctl_net_ipv4_conf_all_accept_source_route: true
    sysctl_net_ipv4_conf_all_send_redirects: true
    sysctl_net_ipv4_conf_default_accept_redirects: true
    sysctl_net_ipv4_conf_default_accept_source_route: true
    sysctl_net_ipv4_conf_default_send_redirects: true
    sysctl_net_ipv4_icmp_echo_ignore_broadcasts: true
    sysctl_net_ipv4_ip_forward: true
    sysctl_net_ipv6_conf_all_accept_source_route: true
    unknown_severity: true
    unknown_strategy: true
  tasks:
    - name: Enable GNOME3 Screensaver Lock After Idle Period
      ini_file:
        dest: /etc/dconf/db/local.d/00-security-settings
        section: org/gnome/desktop/screensaver
        option: lock-enabled
        value: 'true'
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      tags:
      - dconf_gnome_screensaver_lock_enabled
      - medium_severity
      - unknown_strategy
      - low_complexity
      - medium_disruption
      - no_reboot_needed
      - CCE-80112-6
      - NIST-800-53-AC-11(b)
      - NIST-800-171-3.1.10
      - PCI-DSS-Req-8.1.8
      - CJIS-5.5.5
      - DISA-STIG-RHEL-07-010060
      - V-71891
      
    # - name: Rule title of sshd_disable_root_login
      # block:
      # - name: Deduplicate values from /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: false
          # regexp: (?i)^\s*PermitRootLogin\s+
          # state: absent
      # - name: Insert correct line to /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: true
          # line: PermitRootLogin no
          # state: present
          # insertbefore: ^Match
          # validate: /usr/sbin/sshd -t -f %s
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      # tags:
      # - sshd_disable_root_login
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27445-6
      # - NIST-800-53-AC-3
      # - NIST-800-53-AC-6(2)
      # - NIST-800-53-AC-17(b)
      # - NIST-800-53-IA-2
      # - NIST-800-53-IA-2(5)
      # - NIST-800-171-3.1.1
      # - NIST-800-171-3.1.5
      # - CJIS-5.5.6
      # - DISA-STIG-RHEL-07-040370
      # - V-72247
    
    # - name: Rule title of disable_host_auth
      # block:
      # - name: Deduplicate values from /etc/ssh/sshd_config   - V-71959
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: false
          # regexp: (?i)^\s*HostbasedAuthentication\s+
          # state: absent
      # - name: Insert correct line to /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: true
          # line: HostbasedAuthentication no
          # state: present
          # insertbefore: ^Match
          # validate: /usr/sbin/sshd -t -f %s
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      # tags:
      # - disable_host_auth
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27413-4
      # - NIST-800-53-AC-3
      # - NIST-800-53-AC-17
      # - NIST-800-53-CM-6(b)
      # - NIST-800-171-3.1.12
      # - CJIS-5.5.6
      # - DISA-STIG-RHEL-07-010470
      # - V-71959
    
    # - name: Set SSH Idle Timeout Interval
      # block:
      # - name: Deduplicate values from /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: false
          # regexp: (?i)^\s*ClientAliveInterval\s+
          # state: absent
      # - name: Insert correct line to /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: true
          # line: ClientAliveInterval {{ sshd_idle_timeout_value }}
          # state: present
          # insertbefore: ^Match
          # validate: /usr/sbin/sshd -t -f %s
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      # tags:
      # - sshd_set_idle_timeout
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27433-2
      # - NIST-800-53-AC-2(5)
      # - NIST-800-53-SA-8(i)
      # - NIST-800-53-AC-12
      # - NIST-800-53-AC-17(b)
      # - NIST-800-53-SC-10
      # - NIST-800-171-3.1.11
      # - PCI-DSS-Req-8.1.8
      # - CJIS-5.5.6
      # - DISA-STIG-RHEL-07-040320
      # - V-72237
    
    # - name: Rule title of sshd_disable_gssapi_auth
      # block:
      # - name: Deduplicate values from /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: false
          # regexp: (?i)^\s*GSSAPIAuthentication\s+
          # state: absent
      # - name: Insert correct line to /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: true
          # line: GSSAPIAuthentication no
          # state: present
          # insertbefore: ^Match
          # validate: /usr/sbin/sshd -t -f %s
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      # tags:
      # - sshd_disable_gssapi_auth
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-80220-7
      # - NIST-800-53-AC-17(b)
      # - NIST-800-53-CM-6(c)
      # - NIST-800-171-3.1.12
      # - DISA-STIG-RHEL-07-040430
      # - V-72259
  
    # - name: Use Only FIPS 140-2 Validated MACs
      # block:
      # - name: Deduplicate values from /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: false
          # regexp: (?i)^\s*MACs\s+
          # state: absent
      # - name: Insert correct line to /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: true
          # line: MACs {{ sshd_approved_macs }}
          # state: present
          # insertbefore: ^Match
          # validate: /usr/sbin/sshd -t -f %s
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      # tags:
      # - sshd_use_approved_macs
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27455-5
      # - NIST-800-53-AC-17(b)
      # - NIST-800-53-AC-17(2)
      # - NIST-800-53-IA-7
      # - NIST-800-53-SC-13
      # - NIST-800-53-MA-4(6)
      # - NIST-800-171-3.1.13
      # - NIST-800-171-3.13.11
      # - NIST-800-171-3.13.8
      # - DISA-STIG-RHEL-07-040400
      # - V-72253
    
    # - name: Use Only FIPS 140-2 Validated Ciphers   - V-72221
      # block:
      # - name: Deduplicate values from /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: false
          # regexp: (?i)^\s*Ciphers\s+
          # state: absent
      # - name: Insert correct line to /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: true
          # line: Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc,aes192-cbc,aes256-cbc
          # state: present
          # insertbefore: ^Match
          # validate: /usr/sbin/sshd -t -f %s
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      # tags:
      # - sshd_use_approved_ciphers
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27295-5
      # - NIST-800-53-AC-3
      # - NIST-800-53-AC-17(b)
      # - NIST-800-53-AC-17(2)
      # - NIST-800-53-AU-10(5)
      # - NIST-800-53-CM-6(b)
      # - NIST-800-53-IA-5(1)(c)
      # - NIST-800-53-IA-7
      # - NIST-800-53-SI-7
      # - NIST-800-53-SC-13
      # - NIST-800-171-3.1.13
      # - NIST-800-171-3.13.11
      # - NIST-800-171-3.13.8
      # - CJIS-5.5.6
      # - DISA-STIG-RHEL-07-040110
      # - V-72221
    
    # - name: Rule title of sshd_disable_empty_passwords.   - V-71939
      # block:
      # - name: Deduplicate values from /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: false
          # regexp: (?i)^\s*PermitEmptyPasswords\s+
          # state: absent
      # - name: Insert correct line to /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: true
          # line: PermitEmptyPasswords no
          # state: present
          # insertbefore: ^Match
          # validate: /usr/sbin/sshd -t -f %s
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      # tags:
      # - sshd_disable_empty_passwords
      # - high_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27471-2
      # - NIST-800-53-AC-3
      # - NIST-800-53-AC-6
      # - NIST-800-53-AC-17(b)
      # - NIST-800-53-CM-6(b)
      # - NIST-800-171-3.1.1
      # - NIST-800-171-3.1.5
      # - CJIS-5.5.6
      # - DISA-STIG-RHEL-07-010300
      # - V-71939
    
    # - name: Rule title of sshd_do_not_permit_user_env   - V-71957
      # block:
      # - name: Deduplicate values from /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: false
          # regexp: (?i)^\s*PermitUserEnvironment\s+
          # state: absent
      # - name: Insert correct line to /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: true
          # line: PermitUserEnvironment yes
          # state: present
          # insertbefore: ^Match
          # validate: /usr/sbin/sshd -t -f %s
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      # tags:
      # - sshd_do_not_permit_user_env
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27363-1
      # - NIST-800-53-AC-17(b)
      # - NIST-800-53-CM-6(b)
      # - NIST-800-171-3.1.12
      # - CJIS-5.5.6
      # - DISA-STIG-RHEL-07-010460
      # - V-71957
    
    # - name: Set SSH Client Alive Max Count
      # block:
      # - name: Deduplicate values from /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: false
          # regexp: (?i)^\s*ClientAliveCountMax\s+
          # state: absent
      # - name: Insert correct line to /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: true
          # line: ClientAliveCountMax {{ var_sshd_set_keepalive }}
          # state: present
          # insertbefore: ^Match
          # validate: /usr/sbin/sshd -t -f %s
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      # tags:
      # - sshd_set_keepalive
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27082-7
      # - NIST-800-53-AC-2(5)
      # - NIST-800-53-SA-8
      # - NIST-800-53-AC-12
      # - NIST-800-53-AC-17(b)
      # - NIST-800-53-SC-10
      # - NIST-800-171-3.1.11
      # - CJIS-5.5.6
      # - DISA-STIG-RHEL-07-040340
      # - V-72241
    
    # - name: Rule title of sshd_print_last_log
      # block:
      # - name: Deduplicate values from /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: false
          # regexp: (?i)^\s*PrintLastLog\s+
          # state: absent
      # - name: Insert correct line to /etc/ssh/sshd_config
        # lineinfile:
          # path: /etc/ssh/sshd_config
          # create: true
          # line: PrintLastLog yes
          # state: present
          # insertbefore: ^Match
          # validate: /usr/sbin/sshd -t -f %s
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      # tags:
      # - sshd_print_last_log
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-80225-6
      # - NIST-800-53-AC-9
      # - NIST-800-53-AC-17(b)
      # - DISA-STIG-RHEL-07-040360
      # - V-72245
   
    
    # - name: Test for domain group
      # command: grep '\s*\[domain\/[^]]*]' /etc/sssd/sssd.conf
      # register: test_grep_domain
      # ignore_errors: true
      # changed_when: false
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      # tags:
      # - sssd_ldap_configure_tls_ca_dir
      # - medium_severity
      # - unknown_strategy
      # - low_complexity
      # - medium_disruption
      # - no_reboot_needed
      # - CCE-80515-0
      # - DISA-STIG-RHEL-07-040190
      # - V-72229
    
    # - name: Add default domain group and set CA directory (if no domain there)
      # ini_file:
        # path: /etc/sssd/sssd.conf
        # section: '{{ item.section }}'
        # option: '{{ item.option }}'
        # value: '{{ item.value }}'
        # create: true
        # mode: 384
      # with_items:
      # - section: sssd
        # option: domains
        # value: default
      # - section: domain/default
        # option: id_provider
        # value: files
      # - section: domain/default
        # option: ldap_tls_cacertdir
        # value: '{{ var_sssd_ldap_tls_ca_dir }}'
      # when:
      # - test_grep_domain.stdout is defined
      # - test_grep_domain.stdout | length < 1
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
    
      # tags:
      # - sssd_ldap_configure_tls_ca_dir
      # - medium_severity
      # - unknown_strategy
      # - low_complexity
      # - medium_disruption
      # - no_reboot_needed
      # - CCE-80515-0
      # - DISA-STIG-RHEL-07-040190
      # - V-72229
    
    # - name: Configure LDAPs path to CA directory
      # ini_file:
        # path: /etc/sssd/sssd.conf
        # section: '{{ test_grep_domain.stdout | regex_replace(''\[(.*)\]'',''\1'') }}'
        # option: ldap_tls_cacertdir
        # value: '{{ var_sssd_ldap_tls_ca_dir }}'
        # create: true
        # mode: 384
      # when:
      # - test_grep_domain.stdout is defined
      # - test_grep_domain.stdout | length > 0
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
    
      # tags:
      # - sssd_ldap_configure_tls_ca_dir
      # - medium_severity
      # - unknown_strategy
      # - low_complexity
      # - medium_disruption
      # - no_reboot_needed
      # - CCE-80515-0
      # - DISA-STIG-RHEL-07-040190
      # - V-72229
    
    # - name: Set LDAP to be used for authentication
      # lineinfile:
        # path: /etc/sysconfig/authconfig
        # regexp: ^USELDAPAUTH=
        # line: USELDAPAUTH=yes
        # create: true
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
    
      # tags:
      # - sssd_ldap_start_tls
      # - medium_severity
      # - unknown_strategy
      # - low_complexity
      # - medium_disruption
      # - no_reboot_needed
      # - CCE-80546-5
      # - NIST-800-53-AC-17(2)
      # - NIST-800-53-CM-7
      # - DISA-STIG-RHEL-07-040180
      # - V-72227
    
    # - name: Test for domain group
      # command: grep '\s*\[domain\/[^]]*]' /etc/sssd/sssd.conf
      # register: test_grep_domain
      # ignore_errors: true
      # changed_when: false
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
    
      # tags:
      # - sssd_ldap_start_tls
      # - medium_severity
      # - unknown_strategy
      # - low_complexity
      # - medium_disruption
      # - no_reboot_needed
      # - CCE-80546-5
      # - NIST-800-53-AC-17(2)
      # - NIST-800-53-CM-7
      # - DISA-STIG-RHEL-07-040180
      # - V-72227
    
    # - name: Add default domain group and use STARTTLS (if no domain there)
      # ini_file:
        # path: /etc/sssd/sssd.conf
        # section: '{{ item.section }}'
        # option: '{{ item.option }}'
        # value: '{{ item.value }}'
        # create: true
        # mode: 384
      # with_items:
      # - section: sssd
        # option: domains
        # value: default
      # - section: domain/default
        # option: id_provider
        # value: files
      # - section: domain/default
        # option: ldap_id_use_start_tls
        # value: true
      # when:
      # - test_grep_domain.stdout is defined
      # - test_grep_domain.stdout | length < 1
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
    
      # tags:
      # - sssd_ldap_start_tls
      # - medium_severity
      # - unknown_strategy
      # - low_complexity
      # - medium_disruption
      # - no_reboot_needed
      # - CCE-80546-5
      # - NIST-800-53-AC-17(2)
      # - NIST-800-53-CM-7
      # - DISA-STIG-RHEL-07-040180
      # - V-72227
    
    # - name: Configure LDAP to use STARTTLS
      # ini_file:
        # path: /etc/sssd/sssd.conf
        # section: '{{ test_grep_domain.stdout | regex_replace(''\[(.*)\]'',''\1'') }}'
        # option: ldap_id_use_start_tls
        # value: true
        # create: true
        # mode: 384
      # when:
      # - test_grep_domain.stdout is defined
      # - test_grep_domain.stdout | length > 0
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
    
      # tags:
      # - sssd_ldap_start_tls
      # - medium_severity
      # - unknown_strategy
      # - low_complexity
      # - medium_disruption
      # - no_reboot_needed
      # - CCE-80546-5
      # - NIST-800-53-AC-17(2)
      # - NIST-800-53-CM-7
      # - DISA-STIG-RHEL-07-040180
      # - V-72227
   
    
    # - name: Ensure YUM Removes Previous Package Versions
      # lineinfile:
        # dest: /etc/yum.conf
        # regexp: ^#?clean_requirements_on_remove
        # line: clean_requirements_on_remove=1
        # insertafter: \[main\]
        # create: true
      # tags:
      # - clean_components_post_updating
      # - low_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-80346-0
      # - NIST-800-53-SI-2(6)
      # - NIST-800-53-CM-11
      # - NIST-800-171-3.4.8
      # - DISA-STIG-RHEL-07-020200
      # - V-71987

    

    
    # - name: Prevent user modification of GNOME lock-enabled
      # lineinfile:
        # path: /etc/dconf/db/local.d/locks/00-security-settings-lock
        # regexp: ^/org/gnome/desktop/screensaver/lock-enabled
        # line: /org/gnome/desktop/screensaver/lock-enabled
        # create: true
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
    
      # tags:
      # - dconf_gnome_screensaver_lock_enabled
      # - medium_severity
      # - unknown_strategy
      # - low_complexity
      # - medium_disruption
      # - no_reboot_needed
      # - CCE-80112-6
      # - NIST-800-53-AC-11(b)
      # - NIST-800-171-3.1.10
      # - PCI-DSS-Req-8.1.8
      # - CJIS-5.5.5
      # - DISA-STIG-RHEL-07-010060
      # - V-71891
    
    # - name: Prevent user modification of GNOME Session idle-delay
      # lineinfile:
        # path: /etc/dconf/db/local.d/locks/00-security-settings-lock
        # regexp: ^/org/gnome/desktop/session/idle-delay
        # line: /org/gnome/desktop/session/idle-delay
        # create: true
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
    
      # tags:
      # - dconf_gnome_session_idle_user_locks
      # - medium_severity
      # - unknown_strategy
      # - low_complexity
      # - medium_disruption
      # - no_reboot_needed
      # - CCE-80544-0
      # - NIST-800-53-AC-11(a)
      # - NIST-800-171-3.1.10
      # - DISA-STIG-RHEL-07-010082
      # - V-73157
    
    - name: Prevent user modification of GNOME lock-delay
      lineinfile:
        path: /etc/dconf/db/local.d/locks/00-security-settings-lock
        regexp: ^/org/gnome/desktop/screensaver/lock-delay
        line: /org/gnome/desktop/screensaver/lock-delay
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      tags:
      - dconf_gnome_screensaver_user_locks
      - medium_severity
      - unknown_strategy
      - low_complexity
      - medium_disruption
      - no_reboot_needed
      - CCE-80371-8
      - NIST-800-53-AC-11(a)
      - NIST-800-171-3.1.10
      - DISA-STIG-RHEL-07-010081
      - V-73155
    
    
    - name: Ensure AIDE is installed
      package:
        name: '{{ item }}'
        state: present
      with_items:
      - aide
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      tags:
      - aide_periodic_cron_checking
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-26952-2
      - NIST-800-53-CM-3(d)
      - NIST-800-53-CM-3(e)
      - NIST-800-53-CM-3(5)
      - NIST-800-53-CM-6(d)
      - NIST-800-53-CM-6(3)
      - NIST-800-53-SC-28
      - NIST-800-53-SI-7
      - PCI-DSS-Req-11.5
      - CJIS-5.10.1.3
      - DISA-STIG-RHEL-07-020030
      - V-71973

      
    - name: Configure the file integrity tool to run automatically on the system at least weekly.
      lineinfile:
        path: /etc/cron.daily/aide
        regexp: ^#?active
        line: /usr/sbin/aide --check | /bin/mail -s "$HOSTNAME - Daily aide integrity check run" {{ sys_admin_email }}
        create: true
      tags:
      - DISA-STIG-RHEL-07-020030
      - V-71973
      - aide
      - DISA-STIG-RHEL-07-020040
      - V-71975
    
    - name: Ensure aide is installed
      package:
        name: aide
        state: present
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      tags:
      - package_aide_installed
      - medium_severity
      - enable_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-27096-7
      - NIST-800-53-CM-3(d)
      - NIST-800-53-CM-3(e)
      - NIST-800-53-CM-6(d)
      - NIST-800-53-CM-6(3)
      - NIST-800-53-SC-28
      - NIST-800-53-SI-7
      - PCI-DSS-Req-11.5
      - CJIS-5.10.1.3
      - DISA-STIG-RHEL-07-020030
      - V-71973      
    
    - name: Ensure SELinux State is Enforcing
      lineinfile:
        path: /etc/sysconfig/selinux
        regexp: ^SELINUX=
        line: SELINUX={{ var_selinux_state }}
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - selinux_state
      - high_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-27334-2
      - NIST-800-53-AC-3
      - NIST-800-53-AC-3(3)
      - NIST-800-53-AC-3(4)
      - NIST-800-53-AC-4
      - NIST-800-53-AC-6
      - NIST-800-53-AU-9
      - NIST-800-53-SI-6(a)
      - NIST-800-171-3.1.2
      - NIST-800-171-3.7.2
      - DISA-STIG-RHEL-07-020210
      - V-71989
    
    - name: Configure SELinux Policy
      lineinfile:
        path: /etc/sysconfig/selinux
        regexp: ^SELINUXTYPE=
        line: SELINUXTYPE={{ var_selinux_policy_name }}
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - selinux_policytype
      - high_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-27279-9
      - NIST-800-53-AC-3
      - NIST-800-53-AC-3(3)
      - NIST-800-53-AC-3(4)
      - NIST-800-53-AC-4
      - NIST-800-53-AC-6
      - NIST-800-53-AU-9
      - NIST-800-53-SI-6(a)
      - NIST-800-171-3.1.2
      - NIST-800-171-3.7.2
      - DISA-STIG-RHEL-07-020220
      - V-71991
    
    - name: Set rsyslog remote loghost
      lineinfile:
        dest: /etc/rsyslog.conf
        regexp: ^\*\.\*\s@@ #^\*\.\*
        line: '*.* @@{{ rsyslog_remote_loghost_address }}:514'
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      tags:
      - rsyslog_remote_loghost
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-27343-3
      - NIST-800-53-AU-3(2)
      - NIST-800-53-AU-4(1)
      - NIST-800-53-AU-9
      - DISA-STIG-RHEL-07-031000
      - V-72209
    
    - name: Ensure kernel module 'usb-storage' is disabled
      lineinfile:
        create: true
        dest: /etc/modprobe.d/usb-storage.conf
        regexp: usb-storage
        line: install usb-storage /bin/true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - kernel_module_usb-storage_disabled
      - medium_severity
      - disable_strategy
      - low_complexity
      - medium_disruption
      - reboot_required
      - CCE-27277-3
      - NIST-800-53-AC-19(a)
      - NIST-800-53-AC-19(d)
      - NIST-800-53-AC-19(e)
      - NIST-800-53-IA-3
      - NIST-800-53-MP-7
      - NIST-800-171-3.1.21
      - DISA-STIG-RHEL-07-020100
      - V-71983
    
    - name: Unit Service Exists
      shell: systemctl list-unit-files | grep -q '^autofs.service'
      register: service_file_exists
      ignore_errors: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - service_autofs_disabled
      - medium_severity
      - disable_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-27498-5
      - NIST-800-53-AC-19(a)
      - NIST-800-53-AC-19(d)
      - NIST-800-53-AC-19(e)
      - NIST-800-53-IA-3
      - NIST-800-171-3.4.6
      - DISA-STIG-RHEL-07-020110
      - V-71985
    
    - name: Disable service autofs
      systemd:
        name: autofs.service
        enabled: 'no'
        state: stopped
        masked: 'yes'
      when:
      - service_file_exists.rc == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - service_autofs_disabled
      - medium_severity
      - disable_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-27498-5
      - NIST-800-53-AC-19(a)
      - NIST-800-53-AC-19(d)
      - NIST-800-53-AC-19(e)
      - NIST-800-53-IA-3
      - NIST-800-171-3.4.6
      - DISA-STIG-RHEL-07-020110
      - V-71985
    
    - name: Unit Socket Exists
      shell: systemctl list-unit-files | grep -q '^autofs.socket'
      register: socket_file_exists
      ignore_errors: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - service_autofs_disabled
      - medium_severity
      - disable_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-27498-5
      - NIST-800-53-AC-19(a)
      - NIST-800-53-AC-19(d)
      - NIST-800-53-AC-19(e)
      - NIST-800-53-IA-3
      - NIST-800-171-3.4.6
      - DISA-STIG-RHEL-07-020110
      - V-71985
    
    - name: Disable socket autofs
      systemd:
        name: autofs.socket
        enabled: 'no'
        state: stopped
        masked: 'yes'
      when:
      - socket_file_exists.rc == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - service_autofs_disabled
      - medium_severity
      - disable_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-27498-5
      - NIST-800-53-AC-19(a)
      - NIST-800-53-AC-19(d)
      - NIST-800-53-AC-19(e)
      - NIST-800-53-IA-3
      - NIST-800-171-3.4.6
      - DISA-STIG-RHEL-07-020110
      - V-71985
 
    - name: Ensure sysctl net.ipv4.ip_forward is set to 0
      sysctl:
        name: net.ipv4.ip_forward
        value: '0'
        state: present
        reload: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - sysctl_net_ipv4_ip_forward
      - medium_severity
      - disable_strategy
      - low_complexity
      - medium_disruption
      - reboot_required
      - CCE-80157-1
      - NIST-800-53-CM-7
      - NIST-800-53-SC-5
      - NIST-800-53-SC-32
      - NIST-800-171-3.1.20
      - DISA-STIG-RHEL-07-040740
      - V-72309
    
    
    - name: Configure Kerberos 5 Encryption in Audit Event Multiplexor (audispd)
      lineinfile:
        dest: /etc/audisp/audisp-remote.conf
        line: enable_krb5 = yes
        regexp: ^\s*enable_krb5\s*=\s*.*$
        state: present
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      tags:
      - auditd_audispd_encrypt_sent_records
      - medium_severity
      - configure_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80540-8
      - DISA-STIG-RHEL-07-030310
      - V-72085
    
    - name: Configure auditd space_left Action on Low Disk Space
      lineinfile:
        dest: /etc/audit/auditd.conf
        line: space_left_action = {{ var_auditd_space_left_action }}
        regexp: ^\s*space_left_action\s*=\s*.*$
        state: present
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - auditd_data_retention_space_left_action
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-27375-5
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-4
      - NIST-800-53-AU-5(1)
      - NIST-800-53-AU-5(b)
      - NIST-800-53-IR-5
      - NIST-800-171-3.3.1
      - PCI-DSS-Req-10.7
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030340
      - V-72091
    
    - name: Set architecture for audit fremovexattr tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27353-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030480
      - V-72119
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_fremovexattr
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27353-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030480
      - V-72119
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_fremovexattr.matched is defined and find_fremovexattr.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27353-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030480
      - V-72119
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_fremovexattr.files | map(attribute=''path'') | list | first }}'
      when:
      - find_fremovexattr.matched is defined and find_fremovexattr.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27353-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030480
      - V-72119
    
    - name: Inserts/replaces the fremovexattr rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S fremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27353-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030480
      - V-72119
    
    - name: Inserts/replaces the fremovexattr rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S fremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27353-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030480
      - V-72119
    
    - name: Inserts/replaces the fremovexattr rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S fremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27353-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030480
      - V-72119
    
    - name: Inserts/replaces the fremovexattr rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S fremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27353-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030480
      - V-72119
    
    - name: Set architecture for audit fchmod tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27393-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030420
      - V-72107
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_fchmod
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27393-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030420
      - V-72107
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_fchmod.matched is defined and find_fchmod.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27393-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030420
      - V-72107
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_fchmod.files | map(attribute=''path'') | list | first }}'
      when:
      - find_fchmod.matched is defined and find_fchmod.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27393-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030420
      - V-72107
    
    - name: Inserts/replaces the fchmod rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S fchmod -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27393-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030420
      - V-72107
    
    - name: Inserts/replaces the fchmod rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S fchmod -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27393-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030420
      - V-72107
    
    - name: Inserts/replaces the fchmod rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S fchmod -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27393-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030420
      - V-72107
    
    - name: Inserts/replaces the fchmod rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S fchmod -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27393-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030420
      - V-72107
    
    - name: Set architecture for audit fsetxattr tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27389-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030450
      - V-72113
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_fsetxattr
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27389-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030450
      - V-72113
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_fsetxattr.matched is defined and find_fsetxattr.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27389-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030450
      - V-72113
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_fsetxattr.files | map(attribute=''path'') | list | first }}'
      when:
      - find_fsetxattr.matched is defined and find_fsetxattr.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27389-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030450
      - V-72113
    
    - name: Inserts/replaces the fsetxattr rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S fsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27389-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030450
      - V-72113
    
    - name: Inserts/replaces the fsetxattr rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S fsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27389-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030450
      - V-72113
    
    - name: Inserts/replaces the fsetxattr rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S fsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27389-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030450
      - V-72113
    
    - name: Inserts/replaces the fsetxattr rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S fsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27389-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030450
      - V-72113
    
    - name: Set architecture for audit fchown tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      tags:
      - audit_rules_dac_modification_fchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27356-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030380
      - V-72099
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_fchown
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27356-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030380
      - V-72099
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_fchown.matched is defined and find_fchown.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27356-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030380
      - V-72099
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_fchown.files | map(attribute=''path'') | list | first }}'
      when:
      - find_fchown.matched is defined and find_fchown.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27356-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030380
      - V-72099
    
    - name: Inserts/replaces the fchown rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S fchown -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27356-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030380
      - V-72099
    
    - name: Inserts/replaces the fchown rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S fchown -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27356-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030380
      - V-72099
    
    - name: Inserts/replaces the fchown rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S fchown -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27356-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030380
      - V-72099
    
    - name: Inserts/replaces the fchown rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S fchown -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27356-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030380
      - V-72099
    
    - name: Set architecture for audit fchownat tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchownat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27387-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030400
      - V-72103
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_fchownat
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchownat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27387-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030400
      - V-72103
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_fchownat.matched is defined and find_fchownat.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchownat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27387-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030400
      - V-72103
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_fchownat.files | map(attribute=''path'') | list | first }}'
      when:
      - find_fchownat.matched is defined and find_fchownat.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchownat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27387-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030400
      - V-72103
    
    - name: Inserts/replaces the fchownat rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S fchownat -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchownat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27387-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030400
      - V-72103
    
    - name: Inserts/replaces the fchownat rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S fchownat -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchownat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27387-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030400
      - V-72103
    
    - name: Inserts/replaces the fchownat rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S fchownat -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchownat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27387-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030400
      - V-72103
    
    - name: Inserts/replaces the fchownat rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S fchownat -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchownat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27387-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030400
      - V-72103
    
    - name: Set architecture for audit chmod tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_chmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27339-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030410
      - V-72105
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_chmod
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_chmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27339-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030410
      - V-72105
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_chmod.matched is defined and find_chmod.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_chmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27339-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030410
      - V-72105
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_chmod.files | map(attribute=''path'') | list | first }}'
      when:
      - find_chmod.matched is defined and find_chmod.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_chmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27339-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030410
      - V-72105
    
    - name: Inserts/replaces the chmod rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S chmod -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_chmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27339-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030410
      - V-72105
    
    - name: Inserts/replaces the chmod rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S chmod -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_chmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27339-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030410
      - V-72105
    
    - name: Inserts/replaces the chmod rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S chmod -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_chmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27339-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030410
      - V-72105
    
    - name: Inserts/replaces the chmod rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S chmod -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_chmod
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27339-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030410
      - V-72105
    
    - name: Set architecture for audit lremovexattr tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27410-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030490
      - V-72121
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_lremovexattr
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27410-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030490
      - V-72121
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_lremovexattr.matched is defined and find_lremovexattr.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27410-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030490
      - V-72121
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_lremovexattr.files | map(attribute=''path'') | list | first }}'
      when:
      - find_lremovexattr.matched is defined and find_lremovexattr.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27410-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030490
      - V-72121
    
    - name: Inserts/replaces the lremovexattr rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S lremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27410-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030490
      - V-72121
    
    - name: Inserts/replaces the lremovexattr rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S lremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27410-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030490
      - V-72121
    
    - name: Inserts/replaces the lremovexattr rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S lremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27410-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030490
      - V-72121
    
    - name: Inserts/replaces the lremovexattr rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S lremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lremovexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27410-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030490
      - V-72121
    
    - name: Set architecture for audit fchmodat tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmodat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27388-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030430
      - V-72109
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_fchmodat
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmodat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27388-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030430
      - V-72109
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_fchmodat.matched is defined and find_fchmodat.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmodat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27388-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030430
      - V-72109
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_fchmodat.files | map(attribute=''path'') | list | first }}'
      when:
      - find_fchmodat.matched is defined and find_fchmodat.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmodat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27388-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030430
      - V-72109
    
    - name: Inserts/replaces the fchmodat rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S fchmodat -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmodat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27388-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030430
      - V-72109
    
    - name: Inserts/replaces the fchmodat rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S fchmodat -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmodat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27388-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030430
      - V-72109
    
    - name: Inserts/replaces the fchmodat rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S fchmodat -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmodat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27388-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030430
      - V-72109
    
    - name: Inserts/replaces the fchmodat rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S fchmodat -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_fchmodat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27388-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030430
      - V-72109
    
    - name: Set architecture for audit lchown tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27083-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030390
      - V-72101
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_lchown
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27083-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030390
      - V-72101
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_lchown.matched is defined and find_lchown.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27083-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030390
      - V-72101
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_lchown.files | map(attribute=''path'') | list | first }}'
      when:
      - find_lchown.matched is defined and find_lchown.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27083-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030390
      - V-72101
    
    - name: Inserts/replaces the lchown rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S lchown -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27083-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030390
      - V-72101
    
    - name: Inserts/replaces the lchown rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S lchown -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27083-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030390
      - V-72101
    
    - name: Inserts/replaces the lchown rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S lchown -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27083-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030390
      - V-72101
    
    - name: Inserts/replaces the lchown rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S lchown -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lchown
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27083-5
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030390
      - V-72101

    
    - name: Set architecture for audit lsetxattr tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27280-7
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030460
      - V-72115
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_lsetxattr
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27280-7
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030460
      - V-72115
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_lsetxattr.matched is defined and find_lsetxattr.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27280-7
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030460
      - V-72115
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_lsetxattr.files | map(attribute=''path'') | list | first }}'
      when:
      - find_lsetxattr.matched is defined and find_lsetxattr.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27280-7
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030460
      - V-72115
    
    - name: Inserts/replaces the lsetxattr rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S lsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27280-7
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030460
      - V-72115
    
    - name: Inserts/replaces the lsetxattr rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S lsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27280-7
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030460
      - V-72115
    
    - name: Inserts/replaces the lsetxattr rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S lsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27280-7
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030460
      - V-72115
    
    - name: Inserts/replaces the lsetxattr rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S lsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_lsetxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27280-7
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030460
      - V-72115
    
    - name: Set architecture for audit setxattr tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_setxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27213-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030440
      - V-72111
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_setxattr
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_setxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27213-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030440
      - V-72111
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_setxattr.matched is defined and find_setxattr.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_setxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27213-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030440
      - V-72111
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_setxattr.files | map(attribute=''path'') | list | first }}'
      when:
      - find_setxattr.matched is defined and find_setxattr.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_setxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27213-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030440
      - V-72111
    
    - name: Inserts/replaces the setxattr rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S setxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_setxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27213-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030440
      - V-72111
    
    - name: Inserts/replaces the setxattr rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S setxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_setxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27213-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030440
      - V-72111
    
    - name: Inserts/replaces the setxattr rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S setxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_setxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27213-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030440
      - V-72111
    
    - name: Inserts/replaces the setxattr rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S setxattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_setxattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27213-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030440
      - V-72111
    
    - name: Set architecture for audit removexattr tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_removexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27367-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030470
      - V-72117
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_removexattr
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_removexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27367-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030470
      - V-72117
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_removexattr.matched is defined and find_removexattr.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_removexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27367-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030470
      - V-72117
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_removexattr.files | map(attribute=''path'') | list | first }}'
      when:
      - find_removexattr.matched is defined and find_removexattr.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_removexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27367-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030470
      - V-72117
    
    - name: Inserts/replaces the removexattr rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S removexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_removexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27367-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030470
      - V-72117
    
    - name: Inserts/replaces the removexattr rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S removexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_removexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27367-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030470
      - V-72117
    
    - name: Inserts/replaces the removexattr rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S removexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_removexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27367-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030470
      - V-72117
    
    - name: Inserts/replaces the removexattr rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S removexattr -F auid>=1000 -F auid!=unset -F key=perm_mod
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_dac_modification_removexattr
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-27367-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.5.5
      - CJIS-5.4.1.1
      - DISA-STIG-RHEL-07-030470
      - V-72117

    - name: Set architecture for audit lastlog tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      tags:
      - audit_rules_login_events_lastlog
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80384-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.3
      - DISA-STIG-RHEL-07-030620
      - V-72147
    
    - name: Search /etc/audit/rules.d for other user/group modification audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -k logins$
        patterns: '*.rules'
      register: find_lastlog
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_login_events_lastlog
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80384-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.3
      - DISA-STIG-RHEL-07-030620
      - V-72147
    
    - name: If existing user/group modification ruleset not found, use /etc/audit/rules.d/logins.rules as the recipient for the
        rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/logins.rules
      when:
      - find_lastlog.matched is defined and find_lastlog.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_login_events_lastlog
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80384-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.3
      - DISA-STIG-RHEL-07-030620
      - V-72147
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_lastlog.files | map(attribute=''path'') | list | first }}'
      when:
      - find_lastlog.matched is defined and find_lastlog.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_login_events_lastlog
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80384-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.3
      - DISA-STIG-RHEL-07-030620
      - V-72147
    
    - name: Inserts/replaces the lastlog rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -w /var/log/lastlog -p wa -k logins
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_login_events_lastlog
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80384-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.3
      - DISA-STIG-RHEL-07-030620
      - V-72147
    
    - name: Inserts/replaces the lastlog rule in /etc/audit/audit.rules
      lineinfile:
        line: -w /var/log/lastlog -p wa -k logins
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_login_events_lastlog
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80384-1
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.3
      - DISA-STIG-RHEL-07-030620
      - V-72147
 
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/crontab.*$
        patterns: '*.rules'
      register: find_crontab
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_crontab
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80410-4
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030800
      - V-72183
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_crontab.matched is defined and find_crontab.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_crontab
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80410-4
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030800
      - V-72183
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_crontab.files | map(attribute=''path'') | list | first }}'
      when:
      - find_crontab.matched is defined and find_crontab.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_crontab
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80410-4
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030800
      - V-72183
    
    - name: Inserts/replaces the crontab rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/crontab -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_crontab
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80410-4
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030800
      - V-72183
    
    - name: Inserts/replaces the crontab rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/crontab -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_crontab
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80410-4
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030800
      - V-72183
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/libexec/openssh/ssh-keysign.*$
        patterns: '*.rules'
      register: find_ssh_keysign
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_ssh_keysign
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80408-8
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030780
      - V-72179
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_ssh_keysign.matched is defined and find_ssh_keysign.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_ssh_keysign
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80408-8
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030780
      - V-72179
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_ssh_keysign.files | map(attribute=''path'') | list | first }}'
      when:
      - find_ssh_keysign.matched is defined and find_ssh_keysign.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_ssh_keysign
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80408-8
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030780
      - V-72179
    
    - name: Inserts/replaces the ssh_keysign rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/libexec/openssh/ssh-keysign -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_ssh_keysign
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80408-8
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030780
      - V-72179
    
    - name: Inserts/replaces the ssh_keysign rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/libexec/openssh/ssh-keysign -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_ssh_keysign
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80408-8
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030780
      - V-72179
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/gpasswd.*$
        patterns: '*.rules'
      register: find_gpasswd
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_gpasswd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80397-3
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030650
      - V-72153
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_gpasswd.matched is defined and find_gpasswd.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_gpasswd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80397-3
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030650
      - V-72153
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_gpasswd.files | map(attribute=''path'') | list | first }}'
      when:
      - find_gpasswd.matched is defined and find_gpasswd.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_gpasswd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80397-3
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030650
      - V-72153
    
    - name: Inserts/replaces the gpasswd rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/gpasswd -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_gpasswd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80397-3
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030650
      - V-72153
    
    - name: Inserts/replaces the gpasswd rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/gpasswd -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_gpasswd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80397-3
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030650
      - V-72153
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/passwd.*$
        patterns: '*.rules'
      register: find_passwd
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_passwd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80395-7
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030630
      - V-72149
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_passwd.matched is defined and find_passwd.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_passwd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80395-7
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030630
      - V-72149
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_passwd.files | map(attribute=''path'') | list | first }}'
      when:
      - find_passwd.matched is defined and find_passwd.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_passwd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80395-7
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030630
      - V-72149
    
    - name: Inserts/replaces the passwd rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/passwd -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_passwd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80395-7
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030630
      - V-72149
    
    - name: Inserts/replaces the passwd rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/passwd -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_passwd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80395-7
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030630
      - V-72149

    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/sudo.*$
        patterns: '*.rules'
      register: find_sudo
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_sudo
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80401-3
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030690
      - V-72161
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_sudo.matched is defined and find_sudo.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_sudo
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80401-3
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030690
      - V-72161
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_sudo.files | map(attribute=''path'') | list | first }}'
      when:
      - find_sudo.matched is defined and find_sudo.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_sudo
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80401-3
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030690
      - V-72161
    
    - name: Inserts/replaces the sudo rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/sudo -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_sudo
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80401-3
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030690
      - V-72161
    
    - name: Inserts/replaces the sudo rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/sudo -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_sudo
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80401-3
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030690
      - V-72161
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/sbin/postdrop.*$
        patterns: '*.rules'
      register: find_postdrop
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_postdrop
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80406-2
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030760
      - V-72175
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_postdrop.matched is defined and find_postdrop.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_postdrop
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80406-2
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030760
      - V-72175
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_postdrop.files | map(attribute=''path'') | list | first }}'
      when:
      - find_postdrop.matched is defined and find_postdrop.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_postdrop
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80406-2
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030760
      - V-72175
    
    - name: Inserts/replaces the postdrop rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/sbin/postdrop -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_postdrop
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80406-2
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030760
      - V-72175
    
    - name: Inserts/replaces the postdrop rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/sbin/postdrop -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_postdrop
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80406-2
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030760
      - V-72175
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/sbin/pam_timestamp_check.*$
        patterns: '*.rules'
      register: find_pam_timestamp_check
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_pam_timestamp_check
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80411-2
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030810
      - V-72185
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_pam_timestamp_check.matched is defined and find_pam_timestamp_check.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_pam_timestamp_check
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80411-2
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030810
      - V-72185
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_pam_timestamp_check.files | map(attribute=''path'') | list | first }}'
      when:
      - find_pam_timestamp_check.matched is defined and find_pam_timestamp_check.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_pam_timestamp_check
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80411-2
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030810
      - V-72185
    
    - name: Inserts/replaces the pam_timestamp_check rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/sbin/pam_timestamp_check -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_pam_timestamp_check
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80411-2
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030810
      - V-72185
    
    - name: Inserts/replaces the pam_timestamp_check rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/sbin/pam_timestamp_check -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_pam_timestamp_check
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80411-2
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030810
      - V-72185
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/sbin/postqueue.*$
        patterns: '*.rules'
      register: find_postqueue
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_postqueue
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80407-0
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030770
      - V-72177
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_postqueue.matched is defined and find_postqueue.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_postqueue
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80407-0
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030770
      - V-72177
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_postqueue.files | map(attribute=''path'') | list | first }}'
      when:
      - find_postqueue.matched is defined and find_postqueue.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_postqueue
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80407-0
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030770
      - V-72177
    
    - name: Inserts/replaces the postqueue rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/sbin/postqueue -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_postqueue
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80407-0
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030770
      - V-72177
    
    - name: Inserts/replaces the postqueue rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/sbin/postqueue -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_postqueue
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80407-0
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030770
      - V-72177
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/newgrp.*$
        patterns: '*.rules'
      register: find_newgrp
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_newgrp
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80403-9
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030710
      - V-72165
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_newgrp.matched is defined and find_newgrp.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_newgrp
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80403-9
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030710
      - V-72165
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_newgrp.files | map(attribute=''path'') | list | first }}'
      when:
      - find_newgrp.matched is defined and find_newgrp.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_newgrp
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80403-9
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030710
      - V-72165
    
    - name: Inserts/replaces the newgrp rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/newgrp -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_newgrp
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80403-9
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030710
      - V-72165
    
    - name: Inserts/replaces the newgrp rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/newgrp -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_newgrp
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80403-9
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030710
      - V-72165
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/sudoedit.*$
        patterns: '*.rules'
      register: find_sudoedit
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_sudoedit
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80402-1
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030730
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_sudoedit.matched is defined and find_sudoedit.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_sudoedit
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80402-1
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030730
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_sudoedit.files | map(attribute=''path'') | list | first }}'
      when:
      - find_sudoedit.matched is defined and find_sudoedit.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_sudoedit
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80402-1
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030730
    
    - name: Inserts/replaces the sudoedit rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/sudoedit -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_sudoedit
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80402-1
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030730
    
    - name: Inserts/replaces the sudoedit rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/sudoedit -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_sudoedit
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80402-1
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030730
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/sbin/unix_chkpwd.*$
        patterns: '*.rules'
      register: find_unix_chkpwd
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_unix_chkpwd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80396-5
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030640
      - V-72151
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_unix_chkpwd.matched is defined and find_unix_chkpwd.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_unix_chkpwd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80396-5
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030640
      - V-72151
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_unix_chkpwd.files | map(attribute=''path'') | list | first }}'
      when:
      - find_unix_chkpwd.matched is defined and find_unix_chkpwd.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_unix_chkpwd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80396-5
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030640
      - V-72151
    
    - name: Inserts/replaces the unix_chkpwd rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/sbin/unix_chkpwd -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_unix_chkpwd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80396-5
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030640
      - V-72151
    
    - name: Inserts/replaces the unix_chkpwd rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/sbin/unix_chkpwd -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_unix_chkpwd
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80396-5
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030640
      - V-72151
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/su.*$
        patterns: '*.rules'
      register: find_su
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_su
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80400-5
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030680
      - V-72159
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_su.matched is defined and find_su.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_su
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80400-5
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030680
      - V-72159
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_su.files | map(attribute=''path'') | list | first }}'
      when:
      - find_su.matched is defined and find_su.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_su
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80400-5
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030680
      - V-72159
    
    - name: Inserts/replaces the su rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/su -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_su
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80400-5
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030680
      - V-72159
    
    - name: Inserts/replaces the su rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/su -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_su
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80400-5
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030680
      - V-72159
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/chsh.*$
        patterns: '*.rules'
      register: find_chsh
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_chsh
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80404-7
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030720
      - V-72167
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_chsh.matched is defined and find_chsh.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_chsh
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80404-7
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030720
      - V-72167
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_chsh.files | map(attribute=''path'') | list | first }}'
      when:
      - find_chsh.matched is defined and find_chsh.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_chsh
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80404-7
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030720
      - V-72167
    
    - name: Inserts/replaces the chsh rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/chsh -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_chsh
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80404-7
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030720
      - V-72167
    
    - name: Inserts/replaces the chsh rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/chsh -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_chsh
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80404-7
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030720
      - V-72167
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/sbin/userhelper.*$
        patterns: '*.rules'
      register: find_userhelper
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_userhelper
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80399-9
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030670
      - V-72157
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_userhelper.matched is defined and find_userhelper.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_userhelper
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80399-9
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030670
      - V-72157
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_userhelper.files | map(attribute=''path'') | list | first }}'
      when:
      - find_userhelper.matched is defined and find_userhelper.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_userhelper
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80399-9
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030670
      - V-72157
    
    - name: Inserts/replaces the userhelper rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/sbin/userhelper -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_userhelper
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80399-9
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030670
      - V-72157
    
    - name: Inserts/replaces the userhelper rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/sbin/userhelper -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_userhelper
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80399-9
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030670
      - V-72157
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/chage.*$
        patterns: '*.rules'
      register: find_chage
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_chage
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80398-1
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030660
      - V-72155
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_chage.matched is defined and find_chage.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_chage
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80398-1
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030660
      - V-72155
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_chage.files | map(attribute=''path'') | list | first }}'
      when:
      - find_chage.matched is defined and find_chage.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_chage
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80398-1
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030660
      - V-72155
    
    - name: Inserts/replaces the chage rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/chage -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_chage
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80398-1
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030660
      - V-72155
    
    - name: Inserts/replaces the chage rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/chage -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_chage
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80398-1
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030660
      - V-72155
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/umount.*$
        patterns: '*.rules'
      register: find_umount
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_umount
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80405-4
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030750
      - V-72173
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_umount.matched is defined and find_umount.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_umount
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80405-4
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030750
      - V-72173
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_umount.files | map(attribute=''path'') | list | first }}'
      when:
      - find_umount.matched is defined and find_umount.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_umount
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80405-4
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030750
      - V-72173
    
    - name: Inserts/replaces the umount rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/umount -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_umount
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80405-4
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030750
      - V-72173
    
    - name: Inserts/replaces the umount rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/umount -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_privileged_commands_umount
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80405-4
      - NIST-800-53-AU-3(1)
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030750
      - V-72173
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/sbin/semanage.*$
        patterns: '*.rules'
      register: find_semanage
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_semanage
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80391-6
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030560
      - V-72135
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_semanage.matched is defined and find_semanage.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_semanage
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80391-6
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030560
      - V-72135
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_semanage.files | map(attribute=''path'') | list | first }}'
      when:
      - find_semanage.matched is defined and find_semanage.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_semanage
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80391-6
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030560
      - V-72135
    
    - name: Inserts/replaces the semanage rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/sbin/semanage -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_semanage
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80391-6
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030560
      - V-72135
    
    - name: Inserts/replaces the semanage rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/sbin/semanage -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_semanage
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80391-6
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030560
      - V-72135
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/bin/chcon.*$
        patterns: '*.rules'
      register: find_chcon
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_chcon
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80393-2
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030580
      - V-72139
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_chcon.matched is defined and find_chcon.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_chcon
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80393-2
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030580
      - V-72139
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_chcon.files | map(attribute=''path'') | list | first }}'
      when:
      - find_chcon.matched is defined and find_chcon.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_chcon
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80393-2
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030580
      - V-72139
    
    - name: Inserts/replaces the chcon rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/bin/chcon -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_chcon
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80393-2
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030580
      - V-72139
    
    - name: Inserts/replaces the chcon rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/bin/chcon -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_chcon
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80393-2
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030580
      - V-72139
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/sbin/setfiles.*$
        patterns: '*.rules'
      register: find_setfiles
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_setfiles
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80660-4
      - NIST-800-53-AU-12(c)
      - DISA-STIG-RHEL-07-030590
      - V-72141
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_setfiles.matched is defined and find_setfiles.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_setfiles
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80660-4
      - NIST-800-53-AU-12(c)
      - DISA-STIG-RHEL-07-030590
      - V-72141
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_setfiles.files | map(attribute=''path'') | list | first }}'
      when:
      - find_setfiles.matched is defined and find_setfiles.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_setfiles
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80660-4
      - NIST-800-53-AU-12(c)
      - DISA-STIG-RHEL-07-030590
      - V-72141
    
    - name: Inserts/replaces the setfiles rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/sbin/setfiles -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_setfiles
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80660-4
      - NIST-800-53-AU-12(c)
      - DISA-STIG-RHEL-07-030590
      - V-72141
    
    - name: Inserts/replaces the setfiles rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/sbin/setfiles -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_setfiles
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80660-4
      - NIST-800-53-AU-12(c)
      - DISA-STIG-RHEL-07-030590
      - V-72141
    
    - name: Search /etc/audit/rules.d for audit rule entries
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: ^.*path=/usr/sbin/setsebool.*$
        patterns: '*.rules'
      register: find_setsebool
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_setsebool
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80392-4
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030570
      - V-72137
    
    - name: Use /etc/audit/rules.d/privileged.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/privileged.rules
      when:
      - find_setsebool.matched is defined and find_setsebool.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_setsebool
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80392-4
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030570
      - V-72137
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_setsebool.files | map(attribute=''path'') | list | first }}'
      when:
      - find_setsebool.matched is defined and find_setsebool.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_setsebool
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80392-4
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030570
      - V-72137
    
    - name: Inserts/replaces the setsebool rule in rules.d
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F path=/usr/sbin/setsebool -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_setsebool
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80392-4
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030570
      - V-72137
    
    - name: Inserts/replaces the setsebool rule in audit.rules
      lineinfile:
        path: /etc/audit/audit.rules
        line: -a always,exit -F path=/usr/sbin/setsebool -F perm=x -F auid>=1000 -F auid!=unset -F key=privileged
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
      tags:
      - audit_rules_execution_setsebool
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-80392-4
      - NIST-800-53-AU-12(c)
      - NIST-800-171-3.1.7
      - DISA-STIG-RHEL-07-030570
      - V-72137
    
    - name: Set architecture for audit ftruncate tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_ftruncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80390-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030550
      - V-72133
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_ftruncate
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_ftruncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80390-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030550
      - V-72133
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/access.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/access.rules
      when:
      - find_ftruncate.matched is defined and find_ftruncate.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_ftruncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80390-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030550
      - V-72133
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_ftruncate.files | map(attribute=''path'') | list | first }}'
      when:
      - find_ftruncate.matched is defined and find_ftruncate.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_ftruncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80390-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030550
      - V-72133
    
    - name: Inserts/replaces the ftruncate rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: '{{ item }}'
        create: true
      with_items:
      - -a always,exit -F arch=b32 -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b32 -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_ftruncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80390-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030550
      - V-72133
    
    - name: Inserts/replaces the ftruncate rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: '{{ item }}'
        create: true
      with_items:
      - -a always,exit -F arch=b64 -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b64 -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_ftruncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80390-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030550
      - V-72133
    
    - name: Inserts/replaces the ftruncate rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: '{{ item }}'
        state: present
        dest: /etc/audit/audit.rules
        create: true
      with_items:
      - -a always,exit -F arch=b32 -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b32 -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_ftruncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80390-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030550
      - V-72133
    
    - name: Inserts/replaces the ftruncate rule in audit.rules when on x86_64
      lineinfile:
        line: '{{ item }}'
        state: present
        dest: /etc/audit/audit.rules
        create: true
      with_items:
      - -a always,exit -F arch=b64 -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b64 -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_ftruncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80390-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030550
      - V-72133
    
    - name: Set architecture for audit truncate tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_truncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80389-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030540
      - V-72131
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_truncate
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_truncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80389-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030540
      - V-72131
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/access.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/access.rules
      when:
      - find_truncate.matched is defined and find_truncate.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_truncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80389-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030540
      - V-72131
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_truncate.files | map(attribute=''path'') | list | first }}'
      when:
      - find_truncate.matched is defined and find_truncate.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_truncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80389-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030540
      - V-72131
    
    - name: Inserts/replaces the truncate rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: '{{ item }}'
        create: true
      with_items:
      - -a always,exit -F arch=b32 -S truncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b32 -S truncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_truncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80389-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030540
      - V-72131
    
    - name: Inserts/replaces the truncate rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: '{{ item }}'
        create: true
      with_items:
      - -a always,exit -F arch=b64 -S truncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b64 -S truncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_truncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80389-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030540
      - V-72131
    
    - name: Inserts/replaces the truncate rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: '{{ item }}'
        state: present
        dest: /etc/audit/audit.rules
        create: true
      with_items:
      - -a always,exit -F arch=b32 -S truncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b32 -S truncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_truncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80389-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030540
      - V-72131
    
    - name: Inserts/replaces the truncate rule in audit.rules when on x86_64
      lineinfile:
        line: '{{ item }}'
        state: present
        dest: /etc/audit/audit.rules
        create: true
      with_items:
      - -a always,exit -F arch=b64 -S truncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b64 -S truncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_truncate
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80389-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030540
      - V-72131
    
    - name: Set architecture for audit open_by_handle_at tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open_by_handle_at
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80388-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030530
      - V-72129
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_open_by_handle_at
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open_by_handle_at
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80388-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030530
      - V-72129
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/access.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/access.rules
      when:
      - find_open_by_handle_at.matched is defined and find_open_by_handle_at.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open_by_handle_at
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80388-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030530
      - V-72129
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_open_by_handle_at.files | map(attribute=''path'') | list | first }}'
      when:
      - find_open_by_handle_at.matched is defined and find_open_by_handle_at.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open_by_handle_at
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80388-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030530
      - V-72129
    
    - name: Inserts/replaces the open_by_handle_at rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: '{{ item }}'
        create: true
      with_items:
      - -a always,exit -F arch=b32 -S open_by_handle_at -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b32 -S open_by_handle_at -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open_by_handle_at
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80388-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030530
      - V-72129
    
    - name: Inserts/replaces the open_by_handle_at rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: '{{ item }}'
        create: true
      with_items:
      - -a always,exit -F arch=b64 -S open_by_handle_at -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b64 -S open_by_handle_at -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open_by_handle_at
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80388-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030530
      - V-72129
    
    - name: Inserts/replaces the open_by_handle_at rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: '{{ item }}'
        state: present
        dest: /etc/audit/audit.rules
        create: true
      with_items:
      - -a always,exit -F arch=b32 -S open_by_handle_at -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b32 -S open_by_handle_at -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open_by_handle_at
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80388-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030530
      - V-72129
    
    - name: Inserts/replaces the open_by_handle_at rule in audit.rules when on x86_64
      lineinfile:
        line: '{{ item }}'
        state: present
        dest: /etc/audit/audit.rules
        create: true
      with_items:
      - -a always,exit -F arch=b64 -S open_by_handle_at -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b64 -S open_by_handle_at -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open_by_handle_at
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80388-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030530
      - V-72129
    
    - name: Set architecture for audit openat tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_openat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80387-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030520
      - V-72127
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_openat
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_openat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80387-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030520
      - V-72127
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/access.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/access.rules
      when:
      - find_openat.matched is defined and find_openat.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_openat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80387-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030520
      - V-72127
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_openat.files | map(attribute=''path'') | list | first }}'
      when:
      - find_openat.matched is defined and find_openat.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_openat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80387-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030520
      - V-72127
    
    - name: Inserts/replaces the openat rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: '{{ item }}'
        create: true
      with_items:
      - -a always,exit -F arch=b32 -S openat -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b32 -S openat -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_openat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80387-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030520
      - V-72127
    
    - name: Inserts/replaces the openat rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: '{{ item }}'
        create: true
      with_items:
      - -a always,exit -F arch=b64 -S openat -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b64 -S openat -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_openat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80387-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030520
      - V-72127
    
    - name: Inserts/replaces the openat rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: '{{ item }}'
        state: present
        dest: /etc/audit/audit.rules
        create: true
      with_items:
      - -a always,exit -F arch=b32 -S openat -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b32 -S openat -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_openat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80387-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030520
      - V-72127
    
    - name: Inserts/replaces the openat rule in audit.rules when on x86_64
      lineinfile:
        line: '{{ item }}'
        state: present
        dest: /etc/audit/audit.rules
        create: true
      with_items:
      - -a always,exit -F arch=b64 -S openat -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b64 -S openat -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_openat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80387-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030520
      - V-72127
    
    - name: Set architecture for audit open tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80386-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030510
      - V-72125
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=perm_mod$
        patterns: '*.rules'
      register: find_open
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80386-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030510
      - V-72125
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/access.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/access.rules
      when:
      - find_open.matched is defined and find_open.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80386-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030510
      - V-72125
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_open.files | map(attribute=''path'') | list | first }}'
      when:
      - find_open.matched is defined and find_open.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80386-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030510
      - V-72125
    
    - name: Inserts/replaces the open rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: '{{ item }}'
        create: true
      with_items:
      - -a always,exit -F arch=b32 -S open -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b32 -S open -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80386-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030510
      - V-72125
    
    - name: Inserts/replaces the open rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: '{{ item }}'
        create: true
      with_items:
      - -a always,exit -F arch=b64 -S open -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b64 -S open -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80386-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030510
      - V-72125
    
    - name: Inserts/replaces the open rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: '{{ item }}'
        state: present
        dest: /etc/audit/audit.rules
        create: true
      with_items:
      - -a always,exit -F arch=b32 -S open -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b32 -S open -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80386-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030510
      - V-72125
    
    - name: Inserts/replaces the open rule in audit.rules when on x86_64
      lineinfile:
        line: '{{ item }}'
        state: present
        dest: /etc/audit/audit.rules
        create: true
      with_items:
      - -a always,exit -F arch=b64 -S open -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access
      - -a always,exit -F arch=b64 -S open -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_unsuccessful_file_modification_open
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80386-6
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.4
      - PCI-DSS-Req-10.2.1
      - DISA-STIG-RHEL-07-030510
      - V-72125
    
    - name: Set architecture for audit renameat tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_renameat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80413-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030890
      - V-72201
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=delete$
        patterns: '*.rules'
      register: find_renameat
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_renameat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80413-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030890
      - V-72201
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/delete.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/delete.rules
      when:
      - find_renameat.matched is defined and find_renameat.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_renameat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80413-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030890
      - V-72201
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_renameat.files | map(attribute=''path'') | list | first }}'
      when:
      - find_renameat.matched is defined and find_renameat.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_renameat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80413-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030890
      - V-72201
    
    - name: Inserts/replaces the renameat rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S renameat -F auid>=1000 -F auid!=unset -F key=delete
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_renameat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80413-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030890
      - V-72201
    
    - name: Inserts/replaces the renameat rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S renameat -F auid>=1000 -F auid!=unset -F key=delete
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_renameat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80413-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030890
      - V-72201
    
    - name: Inserts/replaces the renameat rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S renameat -F auid>=1000 -F auid!=unset -F key=delete
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_renameat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80413-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030890
      - V-72201
    
    - name: Inserts/replaces the renameat rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S renameat -F auid>=1000 -F auid!=unset -F key=delete
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_renameat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80413-8
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030890
      - V-72201
    
    - name: Set architecture for audit unlinkat tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlinkat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80662-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030920
      - V-72207
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=delete$
        patterns: '*.rules'
      register: find_unlinkat
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlinkat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80662-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030920
      - V-72207
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/delete.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/delete.rules
      when:
      - find_unlinkat.matched is defined and find_unlinkat.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlinkat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80662-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030920
      - V-72207
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_unlinkat.files | map(attribute=''path'') | list | first }}'
      when:
      - find_unlinkat.matched is defined and find_unlinkat.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlinkat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80662-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030920
      - V-72207
    
    - name: Inserts/replaces the unlinkat rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S unlinkat -F auid>=1000 -F auid!=unset -F key=delete
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlinkat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80662-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030920
      - V-72207
    
    - name: Inserts/replaces the unlinkat rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S unlinkat -F auid>=1000 -F auid!=unset -F key=delete
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlinkat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80662-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030920
      - V-72207
    
    - name: Inserts/replaces the unlinkat rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S unlinkat -F auid>=1000 -F auid!=unset -F key=delete
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlinkat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80662-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030920
      - V-72207
    
    - name: Inserts/replaces the unlinkat rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S unlinkat -F auid>=1000 -F auid!=unset -F key=delete
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlinkat
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80662-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030920
      - V-72207
    
    - name: Set architecture for audit rename tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rename
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80995-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030880
      - V-72199
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=delete$
        patterns: '*.rules'
      register: find_rename
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rename
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80995-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030880
      - V-72199
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/delete.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/delete.rules
      when:
      - find_rename.matched is defined and find_rename.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rename
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80995-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030880
      - V-72199
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_rename.files | map(attribute=''path'') | list | first }}'
      when:
      - find_rename.matched is defined and find_rename.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rename
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80995-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030880
      - V-72199
    
    - name: Inserts/replaces the rename rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S rename -F auid>=1000 -F auid!=unset -F key=delete
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rename
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80995-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030880
      - V-72199
    
    - name: Inserts/replaces the rename rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S rename -F auid>=1000 -F auid!=unset -F key=delete
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rename
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80995-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030880
      - V-72199
    
    - name: Inserts/replaces the rename rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S rename -F auid>=1000 -F auid!=unset -F key=delete
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rename
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80995-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030880
      - V-72199
    
    - name: Inserts/replaces the rename rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S rename -F auid>=1000 -F auid!=unset -F key=delete
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rename
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80995-4
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030880
      - V-72199
    
    - name: Set architecture for audit rmdir tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rmdir
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80412-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030900
      - V-72203
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=delete$
        patterns: '*.rules'
      register: find_rmdir
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rmdir
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80412-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030900
      - V-72203
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/delete.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/delete.rules
      when:
      - find_rmdir.matched is defined and find_rmdir.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rmdir
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80412-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030900
      - V-72203
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_rmdir.files | map(attribute=''path'') | list | first }}'
      when:
      - find_rmdir.matched is defined and find_rmdir.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rmdir
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80412-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030900
      - V-72203
    
    - name: Inserts/replaces the rmdir rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S rmdir -F auid>=1000 -F auid!=unset -F key=delete
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rmdir
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80412-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030900
      - V-72203
    
    - name: Inserts/replaces the rmdir rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S rmdir -F auid>=1000 -F auid!=unset -F key=delete
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rmdir
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80412-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030900
      - V-72203
    
    - name: Inserts/replaces the rmdir rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S rmdir -F auid>=1000 -F auid!=unset -F key=delete
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rmdir
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80412-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030900
      - V-72203
    
    - name: Inserts/replaces the rmdir rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S rmdir -F auid>=1000 -F auid!=unset -F key=delete
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_rmdir
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80412-0
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030900
      - V-72203
    
    - name: Set architecture for audit unlink tasks
      set_fact:
        audit_arch: b{{ ansible_architecture | regex_replace('.*(\d\d$)','\1') }}
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlink
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80996-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030910
      - V-72205
    
    - name: Search /etc/audit/rules.d for other DAC audit rules
      find:
        paths: /etc/audit/rules.d
        recurse: false
        contains: -F key=delete$
        patterns: '*.rules'
      register: find_unlink
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlink
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80996-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030910
      - V-72205
    
    - name: If existing DAC ruleset not found, use /etc/audit/rules.d/delete.rules as the recipient for the rule
      set_fact:
        all_files:
        - /etc/audit/rules.d/delete.rules
      when:
      - find_unlink.matched is defined and find_unlink.matched == 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlink
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80996-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030910
      - V-72205
    
    - name: Use matched file as the recipient for the rule
      set_fact:
        all_files:
        - '{{ find_unlink.files | map(attribute=''path'') | list | first }}'
      when:
      - find_unlink.matched is defined and find_unlink.matched > 0
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlink
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80996-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030910
      - V-72205
    
    - name: Inserts/replaces the unlink rule in rules.d when on x86
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b32 -S unlink -F auid>=1000 -F auid!=unset -F key=delete
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlink
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80996-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030910
      - V-72205
    
    - name: Inserts/replaces the unlink rule in rules.d when on x86_64
      lineinfile:
        path: '{{ all_files[0] }}'
        line: -a always,exit -F arch=b64 -S unlink -F auid>=1000 -F auid!=unset -F key=delete
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlink
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80996-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030910
      - V-72205
    
    - name: Inserts/replaces the unlink rule in /etc/audit/audit.rules when on x86
      lineinfile:
        line: -a always,exit -F arch=b32 -S unlink -F auid>=1000 -F auid!=unset -F key=delete
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlink
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80996-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030910
      - V-72205
    
    - name: Inserts/replaces the unlink rule in audit.rules when on x86_64
      lineinfile:
        line: -a always,exit -F arch=b64 -S unlink -F auid>=1000 -F auid!=unset -F key=delete
        state: present
        dest: /etc/audit/audit.rules
        create: true
      when:
      - audit_arch is defined and audit_arch == 'b64'
      - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
    
    
      tags:
      - audit_rules_file_deletion_events_unlink
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - reboot_required
      - CCE-80996-2
      - NIST-800-53-AC-17(7)
      - NIST-800-53-AU-1(b)
      - NIST-800-53-AU-2(a)
      - NIST-800-53-AU-2(c)
      - NIST-800-53-AU-2(d)
      - NIST-800-53-AU-12(a)
      - NIST-800-53-AU-12(c)
      - NIST-800-53-IR-5
      - NIST-800-53-MA-4(1)(a)
      - NIST-800-171-3.1.7
      - PCI-DSS-Req-10.2.7
      - DISA-STIG-RHEL-07-030910
      - V-72205
    
    # - name: Disable Ctrl-Alt-Del Reboot Activation
      # systemd:
        # name: ctrl-alt-del.target
        # masked: true
      # when:
      # - ansible_virtualization_role != "guest" or ansible_virtualization_type != "docker"
      # tags:
      # - disable_ctrlaltdel_reboot
      # - high_severity
      # - disable_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27511-5
      # - NIST-800-53-AC-6
      # - NIST-800-171-3.4.5
      # - DISA-STIG-RHEL-07-020230
      # - V-71993
    
    # - name: Mask the Ctrl-Alt-Del.target Activation
      # ini_file:
        # dest: /etc/dconf/db/local.d/00-disable-CAD
        # section: org/gnome/settings-daemon/plugins/media-keys
        # option: logout
        # value: ''
        # create: true  
      # # lineinfile:
        # # create: true
        # # dest: /etc/dconf/db/local.d/00-disable-CAD
        # # regexp: ^#?logout=
        # # line: logout=''  
      # tags:
      # - DISA-STIG-RHEL-07-020230
      # - V-94843
 

    # - name: Set inactivity timeout
      # lineinfile:
        # path: /etc/profile.d/tmout.sh
        # create: true
        # line: >
          # # !/bin/bash 
          # TMOUT={{ var_accounts_tmout }}
          # readonly TMOUT 
          # export TMOUT
        # state: present
        # validate: bash -n %s
      # tags:
      # - accounts_tmout
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27557-8
      # - NIST-800-53-AC-12
      # - NIST-800-53-SC-10
      # - NIST-800-171-3.1.11
      # - DISA-STIG-RHEL-07-040160
      # - V-72223
    
    
    # - name: Set accounts logon fail delay
      # lineinfile:
        # dest: /etc/login.defs
        # regexp: ^FAIL_DELAY
        # line: FAIL_DELAY {{ var_accounts_fail_delay }}
        # create: true
      # tags:
      # - accounts_logon_fail_delay
      # - low_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - reboot_required
      # - CCE-80352-8
      # - NIST-800-53-AC-7(b)
      # - NIST-800-53-CM-6(b)
      # - DISA-STIG-RHEL-07-010430
      # - V-71951
      # when:
    
    
    
    
    # - name: Limit the Number of Concurrent Login Sessions Allowed Per User
      # lineinfile:
        # state: present
        # dest: /etc/security/limits.conf
        # insertbefore: ^# End of file
        # regexp: ^#?\*.*maxlogins
        # line: '* hard maxlogins {{ var_accounts_max_concurrent_login_sessions }}'
        # create: true
      # tags:
      # - accounts_max_concurrent_login_sessions
      # - low_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-82041-5
      # - NIST-800-53-AC-10
      # - CJIS-5.5.2.2
      # - DISA-STIG-RHEL-07-040000
      # - V-72217
      # when:
    
    
    
    # - name: Ensure PAM variable maxrepeat is set accordingly
      # lineinfile:
        # create: true
        # dest: /etc/security/pwquality.conf
        # regexp: ^#?\s*maxrepeat
        # line: maxrepeat = {{ var_password_pam_maxrepeat }}
      # tags:
      # - accounts_password_pam_maxrepeat
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-82055-5
      # - NIST-800-53-IA-5
      # - NIST-800-53-IA-5(c)
      # - DISA-STIG-RHEL-07-010180
      # - V-71915
      # when:
    
    
    # - name: Ensure PAM variable dcredit is set accordingly
      # lineinfile:
        # create: true
        # dest: /etc/security/pwquality.conf
        # regexp: ^#?\s*dcredit
        # line: dcredit = {{ var_password_pam_dcredit }}
      # tags:
      # - accounts_password_pam_dcredit
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27214-6
      # - NIST-800-53-IA-5(1)(a)
      # - NIST-800-53-IA-5(b)
      # - NIST-800-53-IA-5(c)
      # - NIST-800-53-194
      # - PCI-DSS-Req-8.2.3
      # - DISA-STIG-RHEL-07-010140
      # - V-71907
      # when:
    
    
    # - name: Ensure PAM variable lcredit is set accordingly
      # lineinfile:
        # create: true
        # dest: /etc/security/pwquality.conf
        # regexp: ^#?\s*lcredit
        # line: lcredit = -1 {{ var_password_pam_lcredit }}
      # tags:
      # - accounts_password_pam_lcredit
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27345-8
      # - NIST-800-53-IA-5(b)
      # - NIST-800-53-IA-5(c)
      # - NIST-800-53-IA-5(1)(a)
      # - PCI-DSS-Req-8.2.3
      # - DISA-STIG-RHEL-07-010130
      # - V-71905
      when:
    
    
    # - name: Ensure PAM variable ocredit is set accordingly
      # lineinfile:
        # create: true
        # dest: /etc/security/pwquality.conf
        # regexp: ^#?\s*ocredit
        # line: ocredit = {{ var_password_pam_ocredit }}
      # tags:
      # - accounts_password_pam_ocredit
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27360-7
      # - NIST-800-53-IA-5(b)
      # - NIST-800-53-IA-5(c)
      # - NIST-800-53-IA-5(1)(a)
      # - DISA-STIG-RHEL-07-010150
      # - V-71909
      # when:
    
    
    # - name: Ensure PAM variable minlen is set accordingly
      # lineinfile:
        # create: true
        # dest: /etc/security/pwquality.conf
        # regexp: ^#?\s*minlen
        # line: minlen = {{ var_password_pam_minlen }}
      # tags:
      # - accounts_password_pam_minlen
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27293-0
      # - NIST-800-53-IA-5(1)(a)
      # - PCI-DSS-Req-8.2.3
      # - CJIS-5.6.2.1.1
      # - DISA-STIG-RHEL-07-010280
      # - V-71935
      # when:
    
    
    # - name: Ensure PAM variable difok is set accordingly
      # lineinfile:
        # create: true
        # dest: /etc/security/pwquality.conf
        # regexp: ^#?\s*difok
        # line: difok = {{ var_password_pam_difok }}
      # tags:
      # - accounts_password_pam_difok
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-82020-9
      # - NIST-800-53-IA-5(b)
      # - NIST-800-53-IA-5(c)
      # - NIST-800-53-IA-5(1)(b)
      # - CJIS-5.6.2.1.1
      # - DISA-STIG-RHEL-07-010160
      # - V-71911
      # when:
    
    
    # - name: Ensure PAM variable minclass is set accordingly
      # lineinfile:
        # create: true
        # dest: /etc/security/pwquality.conf
        # regexp: ^#?\s*minclass
        # line: minclass = {{ var_password_pam_minclass }}
      # tags:
      # - accounts_password_pam_minclass
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-82045-6
      # - NIST-800-53-IA-5
      # - DISA-STIG-RHEL-07-010170
      # - V-71913
      # when:
    
    
    # - name: Set Password Retry Prompts Permitted Per-Session - system-auth (change)
      # replace:
        # dest: /etc/pam.d/system-auth
        # follow: true
        # regexp: (^.*\spam_pwquality.so\s.*retry\s*=\s*)(\S+)(.*$)
        # replace: \g<1>{{ var_password_pam_retry }}\g<3>
      # tags:
      # - accounts_password_pam_retry
      # - medium_severity
      # - configure_strategy
      # - low_complexity
      # - medium_disruption
      # - no_reboot_needed
      # - CCE-27160-1
      # - NIST-800-53-CM-6(b)
      # - NIST-800-53-IA-5(c)
      # - CJIS-5.5.3
      # - DISA-STIG-RHEL-07-010119
      # - V-73159
      when:
    
    
    
    
    - name: Set Password Retry Prompts Permitted Per-Session - system-auth (add)
      replace:
        dest: /etc/pam.d/system-auth
        follow: true
        regexp: ^.*\spam_pwquality.so\s(?!.*retry\s*=\s*).*$
        replace: \g<0> retry={{ var_password_pam_retry }}
      # lineinfile:
        # create: true
        # dest: /etc/pam.d/system-auth
        # regexp: (^.*\spam_pwquality.so\s.*retry\s*=\s*)(\S+)(.*$)
        # line: \g<1>{{ var_password_pam_retry }}\g<3> 
      tags:
      - accounts_password_pam_retry
      - medium_severity
      - configure_strategy
      - low_complexity
      - medium_disruption
      - no_reboot_needed
      - CCE-27160-1
      - NIST-800-53-CM-6(b)
      - NIST-800-53-IA-5(c)
      - CJIS-5.5.3
      - DISA-STIG-RHEL-07-010119
      - V-73159
      when:
    
    
    
    
    # - name: Ensure PAM variable maxclassrepeat is set accordingly
      # lineinfile:
        # create: true
        # dest: /etc/security/pwquality.conf
        # regexp: ^#?\s*maxclassrepeat
        # line: maxclassrepeat = {{ var_password_pam_maxclassrepeat }}
      # tags:
      # - accounts_password_pam_maxclassrepeat
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27512-3
      # - NIST-800-53-IA-5
      # - NIST-800-53-IA-5(c)
      # - DISA-STIG-RHEL-07-010190
      # - V-71917
      # when:
    
    
    # - name: Ensure PAM variable ucredit is set accordingly
      # lineinfile:
        # create: true
        # dest: /etc/security/pwquality.conf
        # regexp: ^#?\s*ucredit
        # line: ucredit = {{ var_password_pam_ucredit }}
      # tags:
      # - accounts_password_pam_ucredit
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27200-5
      # - NIST-800-53-IA-5(b)
      # - NIST-800-53-IA-5(c)
      # - NIST-800-53-IA-5(1)(a)
      # - PCI-DSS-Req-8.2.3
      # - DISA-STIG-RHEL-07-010120
      # - V-71903
      # when:
    
    
    # - name: Set Password Hashing Algorithm in /etc/login.defs
      # lineinfile:
        # dest: /etc/login.defs
        # regexp: ^#?ENCRYPT_METHOD
        # line: ENCRYPT_METHOD SHA512
        # state: present
        # create: true
      # tags:
      # - set_password_hashing_algorithm_logindefs
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-82050-6
      # - NIST-800-53-IA-5(b)
      # - NIST-800-53-IA-5(c)
      # - NIST-800-53-IA-5(1)(c)
      # - NIST-800-53-IA-7
      # - NIST-800-171-3.13.11
      # - PCI-DSS-Req-8.2.1
      # - CJIS-5.6.2.2
      # - DISA-STIG-RHEL-07-010210
      # - V-71921
      # when:

    - name: Do not allow users to reuse recent passwords - system-auth (change)
      replace:
        dest: /etc/pam.d/system-auth
        follow: true
        regexp: ^(password\s+sufficient\s+pam_unix\.so\s.*remember\s*=\s*)(\S+)(.*)$
        replace: \g<1>{{ var_password_pam_unix_remember }}\g<3>
      tags:
      - accounts_password_pam_unix_remember
      - medium_severity
      - configure_strategy
      - low_complexity
      - medium_disruption
      - no_reboot_needed
      - CCE-82030-8
      - NIST-800-53-IA-5(f)
      - NIST-800-53-IA-5(1)(e)
      - NIST-800-171-3.5.8
      - PCI-DSS-Req-8.2.5
      - CJIS-5.6.2.1.1
      - DISA-STIG-RHEL-07-010270
      - V-71933
      when:
    
    
    
    
    - name: Do not allow users to reuse recent passwords - system-auth (add)
      replace:
        dest: /etc/pam.d/system-auth
        follow: true
        regexp: ^password\s+sufficient\s+pam_unix\.so\s(?!.*remember\s*=\s*).*$
        replace: \g<0> remember={{ var_password_pam_unix_remember }}
      tags:
      - accounts_password_pam_unix_remember
      - medium_severity
      - configure_strategy
      - low_complexity
      - medium_disruption
      - no_reboot_needed
      - CCE-82030-8
      - NIST-800-53-IA-5(f)
      - NIST-800-53-IA-5(1)(e)
      - NIST-800-171-3.5.8
      - PCI-DSS-Req-8.2.5
      - CJIS-5.6.2.1.1
      - DISA-STIG-RHEL-07-010270
      - V-71933
      when:
    
    
   
    # - name: Set Account Expiration Following Inactivity
      # lineinfile:
        # create: true
        # dest: /etc/default/useradd
        # regexp: ^INACTIVE
        # line: INACTIVE={{ var_account_disable_post_pw_expiration }}
      # tags:
      # - account_disable_post_pw_expiration
      # - medium_severity
      # - restrict_strategy
      # - low_complexity
      # - low_disruption
      # - no_reboot_needed
      # - CCE-27355-7
      # - NIST-800-53-AC-2(2)
      # - NIST-800-53-AC-2(3)
      # - NIST-800-53-IA-4(e)
      # - NIST-800-171-3.5.6
      # - PCI-DSS-Req-8.1.4
      # - CJIS-5.6.2.1.1
      # - DISA-STIG-RHEL-07-010310
      # - V-71941
      # when:
    
    
    - name: Set Password Maximum Age
      lineinfile:
        create: true
        dest: /etc/login.defs
        regexp: ^#?PASS_MAX_DAYS
        line: PASS_MAX_DAYS {{ var_accounts_maximum_age_login_defs }}
      tags:
      - accounts_maximum_age_login_defs
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-27051-2
      - NIST-800-53-IA-5(f)
      - NIST-800-53-IA-5(g)
      - NIST-800-53-IA-5(1)(d)
      - NIST-800-171-3.5.6
      - PCI-DSS-Req-8.2.4
      - CJIS-5.6.2.1
      - DISA-STIG-RHEL-07-010250
      - V-71929
      when:
    
    
    - name: Set Password Minimum Age
      lineinfile:
        create: true
        dest: /etc/login.defs
        regexp: ^#?PASS_MIN_DAYS
        line: PASS_MIN_DAYS {{ var_accounts_minimum_age_login_defs }}
      tags:
      - accounts_minimum_age_login_defs
      - medium_severity
      - restrict_strategy
      - low_complexity
      - low_disruption
      - no_reboot_needed
      - CCE-82036-5
      - NIST-800-53-IA-5(f)
      - NIST-800-53-IA-5(1)(d)
      - NIST-800-171-3.5.8
      - CJIS-5.6.2.1.1
      - DISA-STIG-RHEL-07-010230
      - V-71925
      when:
    
      
    - name: The Red Hat Enterprise Linux operating system must have cron logging implemented
      # Configure "rsyslog" to log all cron messages by adding or updating the following line to "/etc/rsyslog.conf" or a configuration file in the /etc/rsyslog.d/ directory: cron.* /var/log/cron.log
      lineinfile:
        path: /etc/rsyslog.conf
        regexp: ^#?/var/log/cron
        line: cron.* /var/log/cron.log
        create: true
      tags:
      - DISA-STIG-RHEL-07-021100
      - V-72051    
   
    - name: The Red Hat Enterprise Linux operating system must be configured so that the file integrity tool is configured to verify Access Control Lists (ACLs).
      lineinfile:
        dest: /etc/aide.conf
        state: present
        insertafter: '^\s*ALL[\s=]'
        regexp: '^\s*\/sbin[\s\/]'
        line: '/sbin/  ALL'
        backup: yes 
      tags:
      - RHEL-07-021600
      - V-72069
      - RHEL-07-021610
      - V-72071
      - RHEL-07-021620
      - V-72073
  
    # - name: The Red Hat Enterprise Linux operating system must be configured so that the audit system takes appropriate action when the audit storage volume is full.
      # lineinfile:
        # dest: /etc/audisp/audisp-remote.conf
        # line: disk_full_action = single
        # regexp: ^\s*disk_full_action\s*=\s*.*$
        # state: present
        # create: true
      # tags:
      # - DISA-STIG-RHEL-07-030320
      # - V-72087
  
